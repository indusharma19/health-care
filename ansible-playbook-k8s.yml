---
- name: Ensure required Python libraries are installed
  hosts: all
  become: yes
  tasks:
    - name: Install Python Kubernetes library
      pip:
        name: kubernetes
        state: present
        executable: pip3  # Specify pip3 executable if needed

- name: Deploy Health-Care Application on Kubernetes
  hosts: k8s_cluster
  become: yes
  tasks:
    - name: Ensure health-care deployment
      k8s:
        state: present
        definition: |
          apiVersion: apps/v1
          kind: Deployment
          metadata:
            name: health-care
          spec:
            replicas: 2
            selector:
              matchLabels:
                app: health-care
            template:
              metadata:
                labels:
                  app: health-care
              spec:
                containers:
                  - name: health-care
                    image: indu1919/health-care:v1
                    ports:
                      - containerPort: 8081

    - name: Expose the Deployment
      k8s:
        state: present
        definition: |
          apiVersion: v1
          kind: Service
          metadata:
            name: health-care-service
          spec:
            selector:
              app: health-care
            ports:
              - protocol: TCP
                port: 8085
                targetPort: 8081
            type: NodePort
